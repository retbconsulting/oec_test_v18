<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Assets -->


    <template id="portal_confirm_request_registration">
        <t t-call="portal.portal_layout">
            <t t-set="additional_title">Confirmation</t>
            <style>
                .steps-form {
                display: table;
                width: 100%;
                position: relative;
                }
                .steps-form .steps-row {
                display: table-row;
                }
                .steps-form .steps-row:before {
                top: 14px;
                bottom: 0;
                position: absolute;
                content: " ";
                width: 100%;
                height: 1px;
                background-color: #ccc;
                }
                .steps-form .steps-row .steps-step {
                display: table-cell;
                text-align: center;
                position: relative;
                }
                .steps-form .steps-row .steps-step p {
                margin-top: 0.5rem;
                }
                .steps-form .steps-row .steps-step button[disabled] {
                opacity: 1 !important;
                filter: alpha(opacity=100) !important;
                }
                .steps-form .steps-row .steps-step .btn-circle {
                width: 30px;
                height: 30px;
                text-align: center;
                padding: 6px 0;
                font-size: 12px;
                line-height: 1.428571429;
                border-radius: 15px;
                margin-top: 0;
                }
                select[disabled] {
                -webkit-appearance: none;
                -moz-appearance: none;
                text-indent: 0.01px;
                text-overflow: '';
                }
            </style>
            <form action="/registration/submit" method="post">
                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                <div class="row o_portal_details col-xl-8">
                    <div class="alert alert-danger float-center" style="position: absolute"
                         role="alert">
                        <h4 class="alert-heading">Confirmation!</h4>
                        <p>Nous confirmons la réception de votre demande. Un lien vous
                            sera envoyé pour continuer votre inscription
                        </p>
                        <hr/>
                        <p class="mb-0">
                            <a href="/" class="mb-2 btn btn-secondary rounded-circle btn-sm">
                                Page d'acceuil
                            </a>

                        </p>
                    </div>
                </div>
            </form>
        </t>
    </template>

    <template id="portal_request_registration">
        <t t-call="portal.portal_layout">
            <!--<t t-set="status_register" t-value="request.env.user.partner_id.status_register"/>
            <t t-set="all_statuses" t-value="request.env['res.partner']._get_status_register()"/>
            <t t-set="status_keys" t-value="[s[0] for s in all_statuses]"/>
            <t t-set="current_index"
               t-value="status_keys.index(status_register) if status_register in status_keys else 0"/>

            <div class="progress-tracker" style="margin-bottom: 30px;">
                <ol class="step-list" style="display: flex; list-style: none; padding-left: 0;">
                    <t t-foreach="all_statuses" t-as="step">
                        <t t-set="step_key" t-value="step[0]"/>
                        <t t-set="step_label" t-value="step[1]"/>
                        <t t-set="step_index" t-value="all_statuses.index(step)"/>

                        <li t-attf-class="step-item
                #{'completed' if step_index &lt; current_index else ''}
                #{'active' if step_key == status_register else ''}"
                            style="flex: 1; text-align: center; padding: 10px; position: relative;">

                            <div style="width: 30px; height: 30px; border-radius: 50%; background: #{'green' if step_key == status_register else '#ccc'}; margin: auto;">
                                <span style="color: white; line-height: 30px;">
                                    <t t-esc="step_index + 1"/>
                                </span>
                            </div>
                            <div style="margin-top: 5px;">
                                <t t-esc="step_label"/>
                            </div>

                            <t t-if="not step_index == len(all_statuses) - 1">
                                <div style="position: absolute; top: 15px; right: -50%; width: 100%; height: 2px; background: #ccc;"></div>
                            </t>
                        </li>
                    </t>
                </ol>
            </div>

            <style>
                .circle {
                width: 35px;
                height: 35px;
                border-radius: 50%;
                background: #ccc;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 14px;
                font-weight: bold;
                }

                .step-item {
                position: relative;
                }

                .step-label {
                font-size: 13px;
                font-weight: 500;
                max-width: 120px;
                margin: auto;
                }

                .connector {
                position: absolute;
                top: 17px;
                left: 50%;
                width: 100%;
                height: 2px;
                background: #ccc;
                z-index: -1;
                }

                .step-item.completed .circle {
                background: #4C0000;
                }

                .step-item.completed .coennector {
                background: #4C0000;
                }

                .step-item.completed .step-label {
                color: #4C0000;
                font-weight: bold;
                }

                .step-item .circle {
                transition: background 0.3s ease;
                }

                .progress-tracker {
                -active: #4C0000;
                }
            </style>-->


            <t t-set="additional_title">Demande d'inscription</t>

            <style>
                .hidden-field {
                display: none;
                }
                .required-field::after {
                content: " *";
                color: red;
                }
                .form-section {
                margin-bottom: 30px;
                padding: 20px;
                background: #f9f9f9;
                border-radius: 5px;
                }
            </style>
            <input type="hidden" name="send_notification" value="1"/>
            <form action="/demande-inscription" method="post" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                <div class="form-section">
                    <h3>Type d'inscription</h3>

                    <div class="form-group">
                        <label for="mode_registration_inscription" class="required-field">Mode d'inscription</label>
                        <select id="mode_registration_inscription" class="form-control" required="required">
                            <option value="">-- Sélectionner --</option>
                            <option value="pp">Personne Physique</option>
                            <option value="pm">Personne Morale</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="type_selection" class="required-field">Type d'inscription</label>
                        <select id="type_selection" class="form-control" required="required">
                            <option value="">-- Sélectionner un type --</option>
                        </select>
                    </div>
                </div>

                <!-- Champs Personne Physique -->
                <div class="form-section" id="base_fields">
                    <h3>Informations Personne Physique</h3>
                    <div class="row">
                        <div class="form-group col-md-6">
                            <label class="required-field">Nom</label>
                            <input type="text" name="name" class="form-control" required="required"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label class="required-field">Prénom</label>
                            <input type="text" name="prenom" class="form-control" required="required"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label class="required-field">Email</label>
                            <input type="email" name="email" class="form-control" required="required"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label class="required-field">CIN (Recto/Verso)</label>
                            <input type="file" name="copie_cin" class="form-control" required="required"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label class="required-field">Diplôme</label>
                            <input type="file" name="diplome_document" class="form-control" required="required"/>
                        </div>
                    </div>
                </div>

                <!-- Cabinet rattaché -->
                <div class="form-section hidden-field" id="cabinet_rattache_row">
                    <h3>Cabinet Rattaché</h3>
                    <div class="form-group">
                        <label class="required-field">Cabinet</label>
                        <select name="cabinet_rattache" class="form-control" required="required">
                            <option value="">-- Sélectionner --</option>
                            <t t-foreach="companies" t-as="company">
                                <option t-att-value="company.id" t-esc="company.name"/>
                            </t>
                        </select>
                    </div>
                </div>

                <!-- Champs Personne Morale -->
                <div class="form-section hidden-field" id="pm_fields">
                    <h3>Informations Personne Morale</h3>
                    <div class="row">
                        <div class="form-group col-md-6">
                            <label class="required-field">Dénomination</label>
                            <input type="text" name="denomination" class="form-control" required="required"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Numéro RC</label>
                            <input type="text" name="rc" class="form-control"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label>ICE</label>
                            <input type="text" name="ice" class="form-control"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Siège social</label>
                            <input type="text" name="siege_social" class="form-control"/>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Statuts</label>
                            <input type="file" name="statuts" class="form-control"/>
                        </div>
                    </div>
                </div>

                <!-- Connexion requise -->
                <div class="form-section hidden-field" id="login_required_section">
                    <h3>Connexion Requise</h3>
                    <p>Vous devez être connecté en tant que personne physique déjà inscrite pour effectuer cette
                        demande.
                    </p>
                    <a href="/web/login" class="btn btn-primary">Se connecter</a>
                </div>

                <div class="form-section">
                    <div class="form-group">
                        <input type="checkbox" name="declaration_honneur" id="declaration_honneur" required="required"/>
                        <label for="declaration_honneur" class="required-field">
                            J’autorise le Conseil Régional de l’Ordre des Experts-Comptables de Casablanca et Régions du
                            Centre
                            à collecter et traiter mes données personnelles, conformément à la loi 09-08 relative à la
                            protection des personnes physiques à l’égard du traitement des données à caractère
                            personnel.
                        </label>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">Envoyer la demande</button>
            </form>

            <script type="text/javascript">
                document.addEventListener("DOMContentLoaded", function() {
                var optionsConfig = {
                pp: [
                ["e", "Inscription d'une personne physique à titre individuel"],
                ["b", "Inscription d'une personne physique en tant que salarié d'un cabinet inscrit"],
                ["d", "Inscription d'une personne physique en tant qu'associé d'un cabinet inscrit"]
                ],
                pm: [
                ["c", "Inscription d'une personne morale et d'une personne physique"],
                ["a", "Inscription d'une personne morale nouvelle par une personne physique déjà inscrite"]
                ]
                };

                function loadTypeOptions() {
                var mode = document.getElementById("mode_registration_inscription").value;
                var typeSelect = document.getElementById("type_selection");

                typeSelect.innerHTML = '';
                typeSelect.add(new Option("-- Sélectionner --", ""));

                if (mode &amp;&amp; optionsConfig[mode]) {
                optionsConfig[mode].forEach(function(opt) {
                typeSelect.add(new Option(opt[1], opt[0]));
                });
                }
                }

                function updateFields() {
                var mode = document.getElementById("mode_registration_inscription").value;
                var type = document.getElementById("type_selection").value;

                // Reset
                document.getElementById("base_fields").style.display = "none";
                document.getElementById("cabinet_rattache_row").style.display = "none";
                document.getElementById("pm_fields").style.display = "none";
                document.getElementById("login_required_section").style.display = "none";

                // PP individuelle
                if (mode === "pp" &amp;&amp; type === "e") {
                document.getElementById("base_fields").style.display = "block";
                }
                // PP salarié/associé
                else if (mode === "pp" &amp;&amp; (type === "b" || type === "d")) {
                document.getElementById("base_fields").style.display = "block";
                document.getElementById("cabinet_rattache_row").style.display = "block";
                }
                // PM + PP
                else if (mode === "pm" &amp;&amp; type === "c") {
                document.getElementById("base_fields").style.display = "block";
                document.getElementById("pm_fields").style.display = "block";
                }
                // PM par PP existante
                else if (mode === "pm" &amp;&amp; type === "a") {
                document.getElementById("login_required_section").style.display = "block";
                }
                }

                document.getElementById("mode_registration_inscription").addEventListener("change", function() {
                loadTypeOptions();
                updateFields();
                });

                document.getElementById("type_selection").addEventListener("change", updateFields);

                // Initial load
                loadTypeOptions();
                });
            </script>
        </t>
    </template>

    <template id="portal_inscription_submit">
        <t t-call="portal.portal_layout">
            <div class="container mt-4 mb-5">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0">Confirmation de votre demande d'inscription</h3>
                    </div>

                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h4 class="text-primary">Informations personnelles</h4>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Nom:</label>
                                    <div class="col-sm-8">
                                        <p class="form-control-plaintext" t-esc="name"/>
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Prénom:</label>
                                    <div class="col-sm-8">
                                        <p class="form-control-plaintext" t-esc="prenom"/>
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Email:</label>
                                    <div class="col-sm-8">
                                        <p class="form-control-plaintext" t-esc="email"/>
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Mode d'inscription:</label>
                                    <div class="col-sm-8">
                                        <p class="form-control-plaintext" t-esc="mode"/>
                                    </div>
                                </div>

                                <div t-if="type_selection" class="form-group row">
                                    <label class="col-sm-4 col-form-label">Type de sélection:</label>
                                    <div class="col-sm-8">
                                        <p class="form-control-plaintext" t-esc="type_selection"/>
                                    </div>
                                </div>

                                <div t-if="show_pp_rattache and pp_rattache" class="form-group row">
                                    <label class="col-sm-4 col-form-label">Rattaché à:</label>
                                    <div class="col-sm-8">
                                        <p class="form-control-plaintext" t-esc="pp_rattache"/>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <h4 class="text-primary">Documents joints</h4>

                                <div t-if="has_copie_cin" class="form-group">
                                    <label>Copie CIN:</label>
                                    <div>
                                        <a href="/download/document?doc_type=cin" class="btn btn-outline-primary">
                                            <i class="fa fa-download mr-2"/>
                                            Télécharger
                                        </a>
                                    </div>
                                </div>

                                <div t-if="has_diplome" class="form-group">
                                    <label>Diplôme:</label>
                                    <div>
                                        <a href="/download/document?doc_type=diplome" class="btn btn-outline-primary">
                                            <i class="fa fa-download mr-2"/>
                                            Télécharger
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-4">
                            <form method="post">
                                <button type="submit" name="confirm" class="btn btn-primary mr-3">
                                    <i class="fa fa-check mr-2"/>
                                    Confirmer l'inscription
                                </button>
                                <a href="/demande-inscription" class="btn btn-secondary">
                                    <i class="fa fa-edit mr-2"/>
                                    Modifier
                                </a>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    

</odoo>